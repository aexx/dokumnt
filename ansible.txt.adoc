
== Ansible


=== Control node

.Install on Control node
----
sudo apt install openssh-server
sudo adduser ansible
sudo vi /etc/sudoers.d/ansible
$ nl /etc/sudoers.d/ansible
     1  ansible ALL=(ALL:ALL) NOPASSWD:ALL
# Login als ansible
sudo apt install -y software-properties-common
sudo apt install python -y
sudo apt-add-repository ppa:ansible/ansible
sudo apt install ansible -y
#
$ cd ; ansible-config init --disabled -t all > ansible.cfg
sudo mkdir /etc/ansible/
sudo vi /etc/ansible/hosts
ansible@tine-Inspi-1520:~$ nl /etc/ansible/hosts
     1  [myhosts]
     2  aspix3950
     3  tuxedo
ansible@tine-Inspi-1520:~$ 
#
ssh-keygen
ssh-copy-id ansible@aspix395
ssh-copy-id ansible@tuxedo0
$ ansible all -m ping  ## or $ ansible aspix3950 -m ping
tuxedo | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3.12"
    },
    "changed": false,
    "ping": "pong"
}
aspix3950 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3.12"
    },
    "changed": false,
    "ping": "pong"
}
#
vi apt-pakete-installieren.yaml
ansible-playbook apt-pakete-installieren.yaml --syntax-check
ansible-playbook apt-pakete-installieren.yaml --check
#
sudo apt install git
cd ; mkdir githubaexx ; cd githubaexx
git clone https://github.com/aexx/skript
----


=== Managed Node

.Changed on Managed Node
----
# aspix3950 und tuxedo
dpkg -l|egrep -i python
sudo adduser ansible
sudo vi /etc/sudoers.d/ansible
$ nl /etc/sudoers.d/ansible
     1  ansible ALL=(ALL:ALL) NOPASSWD:ALL
#
----


=== Playbooks

.playbook: apt-pakete-installieren.yaml
----
- hosts: aspix3950
  become: true
  tasks:
  - name : Install multiple packages
    apt: name={{ item }} state=latest update_cache=true
    loop: [unison-gtk, git, krusader, meld, btop, asciidoc, nmap, screen, krename, wakeonlan, x2goclient, pdftk-java, remmina-plugin-rdp, remmina-plugin-x2go, autokey-qt, autokey-gtk, nala]
----

.playbook: dateien-kopieren.yaml
----
- hosts: aspix3950
  become: true
  tasks:
    - name: copy multiple items
      copy: 
        src: "{{ item.src }}" 
        dest: "{{ item.dest }}"
        owner: ok8cp5
        group: ok8cp5
      loop:
        - src: ~/githubaexx/skript/ansible/autostart-ssh-unlock.sh
          dest: /home/ok8cp5/.config/autostart-scripts/autostart-ssh-unlock.sh
        - src: ~/githubaexx/skript/ansible/autostart-ssh-unlock.sh.desktop
          dest: /home/ok8cp5/.config/autostart/autostart-ssh-unlock.sh.desktop
####
    - name: Ensure scripts are executable
      file:
        path: "{{ item.path }}"
        mode: "0755"
      loop:
        - path: /home/ok8cp5/.config/autostart-scripts/autostart-ssh-unlock.sh
#        - path: /home/ok8cp5/loeschmi.sh
----




